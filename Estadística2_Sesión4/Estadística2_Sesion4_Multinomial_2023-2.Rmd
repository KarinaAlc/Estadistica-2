---
title: "Sesion 4 - Multinomial"
author: "Curso: Estadística para el análisis político 2"
date: "Ciclo 2023-2"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
editor_options: 
  markdown: 
    wrap: 72
---

## FACULTAD DE CIENCIAS SOCIALES - PUCP <br>

### Curso: POL 304 - Estadística para el análisis político 2 \| Semestre 2023 - 2 <br>

# **Regresión Logística multinomial**

## Base de Datos

La base de datos a trabajar combina los datos obtenidos en el Democracy
Index (<https://en.wikipedia.org/wiki/Democracy_Index>) y el Index of
Economic Freedom
(<https://en.wikipedia.org/wiki/Index_of_Economic_Freedom>). Lo que
veremos en esta clase es la relación entre el tipo de régimen político
(democracia, democracia fallida y dictadura) con algunas variables
económicas.

Todo esto para comprobar el supuesto: *¿una economía liberal influye en
el nivel de democracia?*

Exploremos la data:

```{r echo = T, results = 'hide',  fig.show='hide'}
library(rio)
demofree=import("https://github.com/schrodingercase/primary/raw/master/demofree.xlsx")
str(demofree) #Ver estructura de la base de datos
```

### Pregunta de investigación

¿Existe alguna relación entre el tipo de régimen político y las
variables "Trade freedom" sistema económico con mayor libertad de
comercio y "Property Rights" Derecho a la propiedad privada.

-VD= Regimen Político

-VI= Trade Freedom (Sistema económico con mayor libertad) y Property
Rights (Derecho a la propiedad privada)

## PASO 1: PREPARACIÓN DE DATA

### 1.1: LIMPIEZA DE DATA E IDENTIFICACIÓN DE VARIABLES

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$regimen=demofree$`Regime type`
demofree$property=demofree$`Property Rights`
demofree$tradefree=demofree$`Trade Freedom`
```

Eliminamos casos perdidos

```{r}
demofree = demofree[complete.cases(demofree$regimen),]
```

Ahora comencemos a dar formato

Comencemos con la variable dependiente:

```{r echo = T, results = 'hide',  fig.show='hide'}
library(car)
table(demofree$regimen)
```

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$regimen = recode(demofree$regimen, "'Full democracy' = 3; 'Hybrid regime' = 2; 'Flawed democracy' = 2; 'Authoritarian' = 1")
table(demofree$regimen)
```

Volvemos factor la variable para poder etiquetarla nuevamente

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$regimen=as.factor(demofree$regimen)
levels(demofree$regimen)=c("Dictadura","Democracia fallida","Democracia")
```

```{r echo = T, results = 'hide',  fig.show='hide'}
table(demofree$regimen)
```

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$property=as.numeric(demofree$property)
demofree$tradefree=as.numeric(demofree$tradefree)
```

### 1.2: ELEGIR NUESTRA LÍNEA DE BASE

```{r echo = T, results = 'hide',  fig.show='hide'}
library(reshape2)
demofree$regimen <- relevel(demofree$regimen , ref = "Democracia fallida")
```

## PASO 2: MODELO LOGÍSTICO

### 2.1 REALIZAR EL MODELO LOGÍSTICO

```{r echo = T, results = 'hide',  fig.show='hide'}
library(nnet)
mod1 <- multinom(regimen ~ property + tradefree, data = demofree)
summary(mod1)
```

### 2.2: RELACIÓN DE LAS VARIABLES  

Un primer paso sería ver el signo de los coeficientes para determinar la
relación entre la variable independiente y la variable dependiente

**Derechos de propiedad**

-   Coeficiente(dictadura) :-0.02654594

-   Coeficiente (democracia): 0.15297576

**Libre comercio**

-   Coeficiente(dictadura) :-0.07105396

-   Coeficiente(democracia):0.01435271

### 2.3: SIGNIFICANCIA DE LAS VARIABLES

```{r echo = T, results = 'hide',  fig.show='hide'}
#install.packages("RVAideMemoire")
library(RVAideMemoire)
test.multinom(mod1,property) # Se colocar test.multinom(nombredelmodelo,variableindependiente1)
```

```{r echo = T, results = 'hide',  fig.show='hide'}
test.multinom(mod1,tradefree)
# Se colocar test.multinom(nombredelmodelo,variableindependiente2)
```

## PASO 3: INTERPRETACIÓN DE COEFICIENTES

### 3.1 REVISAMOS LOS COEFICIENTES

```{r echo = T, results = 'hide',  fig.show='hide'}
exp(coef(mod1))
```

### 3.2 INTERPRETAMOS

**DICTADURA Y DERECHO A LA PROPIEDAD**

-   COEFICIENTE: -0.02654594
-   ODDS : 0.9738033

VECES
```{r echo = T, results = 'hide',  fig.show='hide'}
1/0.9738033
```

PORCENTAJE %
```{r echo = T, results = 'hide',  fig.show='hide'}
(1-0.97)*100 
```

**DICTADURA Y LIBRE COMERCIO**

-   COEFICIENTE: -0.07105396

-   ODDS: 0.93

-   VECES - RELACIÓN INVERSA

VI:DISMINUYE/NO OCURRE VD: AUMENTA/SI OCURRE

```{r echo = T, results = 'hide',  fig.show='hide'}
1/0.9314116
```

-   PORCENTAJE - RELACIÓN INVERSA

VI: AUMENTA/SI OCURRE VD: DISMINUYE/NO OCURRE

```{r echo = T, results = 'hide',  fig.show='hide'}
(1-0.93)*100 
```

**DEMOCRACIA Y DERECHO A LA PROPIEDAD**

-   COEFICIENTE:0.15297576

-   ODDS: 1.17

-   VECES - RELACIÓN DIRECTA

VI:AUMENTA/SI OCURRE VD: AUMENTA/SI OCURRE

-   PORCENTAJE - RELACIÓN DIRECTA

VI: DISMINUYE/NO OCURRE VD: DISMINUYE/NO OCURRE

```{r echo = T, results = 'hide',  fig.show='hide'}
(1.17 - 1) *100
```

**DEMOCRACIA Y LIBRE COMERCIO**

-   COEFICIENTE: 0.01435271
-   ODDS: 1.101

Acá también vemos que es una relación directa. Entonces, para veces solo
tomamos el resultado del exponencial del coeficiente.

-   VECES

-   RELACIÓN DIRECTA VI:AUMENTA/SI OCURRE VD: AUMENTA/SI OCURRE

-   PORCENTAJE - RELACIÓN DIRECTA

VI: DISMINUYE/NO OCURRE VD: DISMINUYE/NO OCURRE

```{r echo = T, results = 'hide',  fig.show='hide'}
(1.01 - 1) *100
```

------------------------------------------------------------------------

## **MODELO 2**

¿Qué sucede si añadimos a nuestras variables independientes una
categórica?

La libertad comercial (Business Freedom) es muchas veces reconocida como
una variable indispensable en toda democracia. ¿Cuánto afectaría al
modelo? Vamos a crear un modelo agregando esta variable al modelo

## PASO 1 PREPARACIÓN DE DATA

Cambiamos el nombre de la variable

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$busfree=demofree$`Business Freedom`
```

La volvemos numérica porque tb es un indicador numérico pero la
volveremos dummy para así poder analizarla como categórica.

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$busfree = as.numeric(demofree$busfree)
```

Pero,para fines prácticos, dividamos esta variable en países con poca
libertad comercial y con mucha libertad comercial.

Libertad comercial Poca Libertad comcercial Mucha

```{r echo = T, results = 'hide',  fig.show='hide'}
demofree$busfreef = cut(demofree$busfree, 2, labels = c("Poca", "Mucha"))
```

##### Volvemos "Dummy"

Utilizamos el paquete fastDummies para dicotomizar las variables, en
select_columns indicamos qué variable queremos dicotomizar

```{r echo = T, results = 'hide',  fig.show='hide'}
library(fastDummies)
demofree=dummy_cols(demofree, select_columns = c("busfreef"))
```

```{r echo = T, results = 'hide',  fig.show='hide'}
names(demofree)
```

```{r echo = T, results = 'hide',  fig.show='hide'}
table(demofree$busfreef_Poca)
```

```{r echo = T, results = 'hide',  fig.show='hide'}
table(demofree$busfreef_Mucha)
```

## PASO 2: MODELO LOGÍSTICO

```{r echo = T, results = 'hide',  fig.show='hide'}
library(nnet)
mod2<- multinom(regimen ~ property + tradefree + busfreef_Poca, data = demofree)
summary(mod2)
```

## PASO 3: INTERPRETACIÓN DE COEFICIENTES

Calculamos los exponenciales

```{r echo = T, results = 'hide',  fig.show='hide'}
exp(coef(mod2))
```

**DICTADURA Y POCA LIBERTAD ECONÓMICA**

-   COEFICIENTE:-0.03106614
-   ODDS: 0.969411457

```{r echo = T, results = 'hide',  fig.show='hide'}
1/0.969411457
```

-   PORCENTAJE - RELACIÓN INVERSA

VI: AUMENTA/SI OCURRE VD: DISMINUYE/NO OCURRE

```{r echo = T, results = 'hide',  fig.show='hide'}
(1-0.969411457)*100 
```

**DEMOCRACIA Y POCA LIBERTAD ECONÓMICA**

-   COEFICIENTE: -5.51416179

-   ODDS:0.004029303

```{r echo = T, results = 'hide',  fig.show='hide'}
1/0.00402
```

-   PORCENTAJE - RELACIÓN INVERSA

VI: AUMENTA/SI OCURRE VD: DISMINUYE/NO OCURRE

```{r echo = T, results = 'hide',  fig.show='hide'}
(1-0.00402)*100 
```

## PASO 4 COMPARAR Y ELEGIR MODELOS

### AIC

```{r echo = T, results = 'hide',  fig.show='hide'}

AIC(mod1) 
AIC(mod2)
```

### PSEUDO R CUADRADO

```{r echo = T, results = 'hide',  fig.show='hide'}
library("DescTools")
PseudoR2(mod1, which = c("Nagelkerke"))
PseudoR2(mod2, which = c("Nagelkerke"))
```
