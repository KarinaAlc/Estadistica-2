---
title: "Sesi√≥n 2"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: simplex
    highlight: kate
    always_allow_html: true
    code_folding: show
editor_options: 
  markdown: 
    wrap: 72
---

<br>

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%",fig.align="left"}
knitr::include_graphics("logoPUCP.png") 
```

## FACULTAD DE CIENCIAS SOCIALES - PUCP <br>

### Curso: POL 304 - Estad√≠stica para el an√°lisis pol√≠tico 2 \| Semestre 2023 - 2 <br>

### Jefas de Pr√°ctica: Karina Alc√°ntara üë©‚Äçüè´ y Lizette Crisp√≠n üë©‚Äçüè´<br>

# **Recordando la regresi√≥n lineal**

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("egov.png") 
```

El E-Government Development Index (EGDI) o √çndice de Desarrollo de
Gobierno Electr√≥nico es un indicador que mide el nivel de desarrollo de
los servicios gubernamentales en l√≠nea y la capacidad de los gobiernos
para utilizar las tecnolog√≠as de la informaci√≥n y la comunicaci√≥n (TIC)
para proporcionar servicios p√∫blicos eficientes y efectivos. Fue
desarrollado por la Divisi√≥n de Administraci√≥n P√∫blica y Desarrollo de
la ONU en colaboraci√≥n con la Universidad de las Naciones Unidas.

El EGDI se compone de tres dimensiones:

-   Acceso a las tecnolog√≠as de la informaci√≥n y la comunicaci√≥n (TIC),

-   Disponibilidad de servicios gubernamentales en l√≠nea

-   Grado de capacitaci√≥n y compromiso del gobierno con el desarrollo de
    servicios en l√≠nea.

El √≠ndice se mide en una escala de 0 a 1, donde 1 representa el nivel
m√°s alto de desarrollo del gobierno electr√≥nico.

El EGDI es utilizado por los gobiernos, las organizaciones
internacionales y la sociedad civil para evaluar el progreso en el
desarrollo del gobierno electr√≥nico y para identificar las √°reas en las
que se deben hacer mejoras para proporcionar servicios p√∫blicos m√°s
eficientes y efectivos en l√≠nea.

Para mayor informaci√≥n:
<https://publicadministration.un.org/egovkb/en-us/About/Overview/-E-Government-Development-Index>

*Con fines pr√°cticos el d√≠a de hoy se trabajar√° con la data del EGDI
(escala 0 a 1) y con las variables ProcesoElectoral, Policulture y
UsuariosInternet, las cuales provienen de otros estudios.*

```{r,echo=FALSE, out.width="70%",fig.align="center", fig.cap = "Diccionario de datos de EGov.xlsx"}
knitr::include_graphics("pd2_DDatos.png") 
```

Cargar librer√≠as pd2_performance.png

```{r , fig.show='hide',warning=FALSE,message=FALSE}
library(rio)
library(dplyr)
library(ggfortify)
library(see)
library(patchwork)
library(performance) 
library(nortest)
library(lmtest)
library(car)
```

```{r,echo=FALSE, out.width="30%",fig.align="center", fig.cap = "librer√≠a de check_model"}
knitr::include_graphics("pd2_performance.png") 
```

Importamos la base de datos üòº:

```{r, fig.show='hide',warning=FALSE,message=FALSE}
Egov<-import("EGov.xlsx")
names(Egov)
```

## Ejemplo 1: Regresi√≥n lineal simple

Calcularemos un modelo para *predecir el acceso a la informaci√≥n a
partir de participaci√≥n digital*.

-   Variable dependiente: accesoInformacion

-   Variable independiente: participaci√≥nDigital

```{r, fig.show='hide',warning=FALSE,message=FALSE}
modeloRL <- lm(accesoInformacion ~ participaci√≥nDigital, data=Egov)
summary(modeloRL)
```

Algunos detalles:

-   Estimacion (Estimate): Este valor nos dice cu√°nto esperamos que
    cambiar√° el acceso a la informaci√≥n. Por ejemplo, si cambiamos la
    participaci√≥n digital un poquito, √©l modelo te dir√° cu√°nto crees que
    cambiar√° el acceso a la informaci√≥n.

-   (Intercept) Es el valor que esperamos de Y cuando x1 y x2 sean cero

-   los coeficientes de x1, en este caso participaciondigital, nos
    indican respectivamente por cada unidad que aumenta la variable X,
    en cuanto se esperaria que aumente (o disminuya) la variable Y,
    controlando las demas variables.

-   Error Est√°ndar (Std. Error): El modelo puede cometer peque√±os
    errores. El "Error Est√°ndar" nos dice cu√°nto podr√≠a equivocarse en
    su estimaci√≥n. Si el error est√°ndar es peque√±o, significa que el
    modelo es m√°s certero

-   Valor t (t value): El valor t es como una medida que determina si el
    modelo es confiable.

-   Valor p (Pr(\>\|t\|)): El p-value nos dice si los resultado ser√°n
    significativos

-   El R-squared nos dice el porcentaje de la varianza de Y que es
    explicada por el modelo

#### **Seguimos nuestro flujograma para evaluar el modelo:**

1.  **Nos preguntamos si el modelo es v√°lido** ü§î
    -   Si el p-value es menor a 0.05 significa que rechazamos la
        hip√≥tesis nula, lo cual probar√≠a que nuestro modelo s√≠ funciona.
2.  **¬øQu√© tanto explica el modelo?**
    -   Revisamos el R cuadrado ajustado que va de 0 a 1 (0% a 100%)
3.  **Si la variable independiente aporta al modelo**
    -   Nos enfocamos en el p-value de cada independiente
4.  **Identificamos los coeficientes**
    -   En este caso hacemos uso del c√≥digo modelo1\$coefficients.

A√ëADIR GR√ÅFICO CON RESIDUOS (EST1)

### ¬øQu√© sucede si agregamos m√°s variables? üëæ

```{r,echo=FALSE, out.width="20%",fig.align="center",fig.cap="Tehc is a meme man character  which is similarly used for tasks for which one might feel disproportionately proud of doing, though Tehc is paired with technology"}
knitr::include_graphics("tehc.png") 
```

## Ejemplo 2: Regresi√≥n lineal m√∫ltiple

Calculamos nuestro modelo, en este caso usaremos lo siguiente:

-   Variable dependiente: accesoInformacion

-   Variables independientes: Capital_Humano + Policulture +
    Telecommunicacion_Infrastructura + ProcesoElectoral

```{r, fig.show='hide',warning=FALSE,message=FALSE}
modelo1<- Egov %>% lm(accesoInformacion ~ Capital_Humano + Policulture + Telecommunicacion_Infrastructura + ProcesoElectoral,data=.)
summary(modelo1)

```

Seguimos nuestro flujograma para evaluar el modelo:

a.  **Nos preguntamos si el modelo es v√°lido:**

-   Si el p-value es menor a 0.05 significa que rechazamos la hip√≥tesis
    nula, lo cual probar√≠a que nuestro modelo s√≠ funciona.
-   Al tener un p-value de 2.2e-1-16 nuestro modelo s√≠ funciona.

b.  **¬øQu√© tanto explica el modelo?**

-   Revisamos el **R cuadrado** que va de 0 a 1 (0% a 100%)

-   En este caso mis variables (en conjunto) explican el 92.13% de la
    variabilidad de mi dependiente, esto es bueno, pero quiz√° podr√≠a ser
    mejor üòØ

c.  **¬øLas variables independientes aportan al modelo?**

-   Nos enfocamos en el p-value de cada independiente

-   corroboramos que estas rechacen la hip√≥tesis nula, es decir que sean
    menores que 0.05.

-   Vemos que todas nuestras variables cumplen ‚úÖ

d.  **Identificamos los coeficientes**

-   En este caso hacemos uso del c√≥digo `modelo1$coefficients`.

```{r, fig.show='hide',warning=FALSE,message=FALSE}
modelo1$coefficients
```

-   Armamos nuestra ecuaci√≥n: y=-0.121108754+
    Capital_Humano(0.338730284)+....

# **SUPUESTOS**

Las inferencias del modelo de regresi√≥n ser√° confiable/correcta
solamente si se cumplen los supuestos.

‚ô¶Ô∏è Tabla resumen 1

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("PD2_SUP.png") 
```

‚ô¶Ô∏è Tabla resumen 2

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("PD2_SUP2.png") 
```

### **1- Linealidad** (el problema es la no linealidad)

Como su nombre lo dice, debe de existir una linealidad entre la variable
independiente y dependiente, en otras palabras,la linealidad indica que
el valor esperado de la variable dependiente es una *funci√≥n lineal* de
cada variable independiente, manteniendo las dem√°s fijas. La pendiente
de esa l√≠nea no depende de los valores de las otras variables, por ello
tambi√©n nos fijamos variable por variable. Los efectos de diferentes
variables independientes sobre el valor esperado de la variable
dependiente son aditivos. Si este supuesto no se cumple significar√≠a que
posiblemente existan variables que no aporten al modelo o que se trate
de una relaci√≥n no lineal [*polinomial, log√≠stica, logaritmicos*].

**C√≥mo detectarlo**

a.  Exploraci√≥n gr√°fica: Plot de valores residuales frente a valores
    predichos.

La l√≠nea verde deber√≠a de estar lo m√°s cercana a la l√≠nea punteada.

```{r}
#Exploraci√≥n gr√°fica
check_model(modelo1,check ="linearity")
```

b.  Correlaci√≥n: `cor.test`

p-value menor a 0.05 rechazo la hip√≥tesis nula: s√≠ hay correlaci√≥n entre
las variables.

```{r}
cor.test(Egov$accesoInformacion, Egov$Capital_Humano)
```

```{r}
cor.test(Egov$accesoInformacion , Egov$Policulture)
```

```{r}
cor.test(Egov$accesoInformacion , Egov$Telecommunicacion_Infrastructura )
```

```{r}
cor.test(Egov$accesoInformacion,Egov$ProcesoElectoral)
```

### **2. Normalidad de residuos** (el problema es la NO normalidad)

**Descripci√≥n**

Identificar si los errores siguen una distribuci√≥n normal. La resta del
valor observado menos el valor pronosticado (residuos) siguen una
distribuci√≥n normal, esto es importante porque si es que no se cumple no
se podr√≠an aplicar las pruebas globales del modelo.

**¬øC√≥mo detectarlo?**

a.  Exploraci√≥n gr√°fica

Todos los puntos deber√≠an estar sobre la diagonal color verde.

```{r,message=FALSE}
#Exploraci√≥n gr√°fica
check_model(modelo1,check ="qq") #quantile-quantile plot
```

b.  Pruebas de normalidad a los residuos: Lilliefors
    (kolmogorov-Smirnov) [mayores a 50 casos] o Shapiro-Wilks [menores a
    50 casos]

```{r,  message=FALSE}
lillie.test(modelo1$resid)
```

**Ojo con la hip√≥tesis nula**. H0: Es normal (distribuci√≥n normal) \|
Ha: No es normal (no hay distribuci√≥n normal)

Si el pvalor es menor a 0.05 entonces *NO existe normalidad de residuos*
(problemas! ‚ò†Ô∏è), se rechazar√≠a la distribuci√≥n normal. Dado que nuestro
p-value es 0.05342, mayor que 0.05, entonces s√≠ estamos frente a un caso
de distribuci√≥n normal de los residuos.

### **3. Homocedasticidad** (el problema es la heterocedasticidad)

**Descripci√≥n**

La homocedasticidad (tambi√©n conocido como *homogeneidad en la varianza
de los residuos*) indica que las variancias de los errores son
constantes. Cuando no se cumple es un problema porque los estimadores no
son consistentes ni eficientes y se presenta el caso de la
heterocedasticidad.

**C√≥mo detectarlo**

a.  Exploraci√≥n gr√°fica: diagrama de residuos standarizados y valores
    predichos.

```{r, message=FALSE}
check_model(modelo1, check="homogeneity")
```

En el Gr√°fico la l√≠nea verde debe seguir una tendencia horizontal, esto
representar√≠a que la distribuci√≥n de los puntos son uniformes. Al ver
nuestro gr√°fico nos damos cuenta que la l√≠nea verde va hacia arriba, lo
cual nos dice que el gr√°fico no es concluyente a√∫n.

b.  Test Breusch Pagan: Tambi√©n llamado como el Score Test for
    Non-Constant Error Variance. Eval√∫a si la varianza del error cambia
    con el nivel de la variable respuesta (valores ajustados) o con una
    combinaci√≥n lineal de predictores.

```{r, message=FALSE, warning=FALSE}
bptest(modelo1)
```

-   H0: El modelo es homoced√°stico
-   Ha: El modelo es heteroced√°stico

Si el pvalor es menor a 0.05 entonces el modelo es heteroced√°stico
(problema! ‚ò†Ô∏è ). Esta vez estamos frente a un modelo homoced√°stico

### **4. Ausencia de multicolinealidad** (el problema es la presencia de multicolinealidad)

**Descripci√≥n**

Se aplica en la regresi√≥n lineal M√öLTIPLE. Significa que las variables
explicativas est√°n relacionadas linealmente entre s√≠. La
multicolinealidad hace que los coeficientes del modelo se vuelvan
inestables, es decir, oscilar√°n violentamente ante cambios m√≠nimos en
las variables de insumo. Esto entender√≠a que existe una relaci√≥n fuerte
entre variables independientes, por lo tanto podr√≠a darnos un modelo
inestable.

**C√≥mo detectarlo**

a.  Con el Factor de Inflaci√≥n de Varianza (VIF). los factores de
    inflaci√≥n de varianza deben de ser menores de 5. De acuerdo a
    nuestros resultados no encontramos multicolinealidad.

-   Mayor a 10, grave problema de multicolinealidad.

**C√≥digo**

```{r,warning=FALSE,message=FALSE}
check_model(modelo1, check="vif")
```

### 5.**Apalancamiento**

**Descripci√≥n**

El indicador de apalancamiento muestra que tanta influencia o "palanca"
pueden tener los residuos en la recta de regresi√≥n. El problema se da
cuando hay puntos con mucha influencia o "*leverage*", ya que al afectar
la l√≠nea de predicci√≥n genera que nuestro modelo sea menos confiable.

**C√≥mo detectarlo**

a.  Gr√°fico: Se espera que la l√≠nea verde tenga un comportamiento
    horizontal. Observamos si hay casos que est√°n afuera de la l√≠nea
    punteada verde.

```{r,warning=FALSE,message=FALSE ,warning=FALSE}
check_model(modelo1, check="outliers")
```

### 6.- **Independencia de residuos** (el problema es que existe autocorrelaci√≥n en los residuos) üö®

**Descripci√≥n** Si los residuos no tienen una distribuci√≥n normal
(supuesto de normalidad), es probable que estos no sean independientes
entre s√≠. Si no se cumple con este supuesto implica que el modelo tiene
sesgo en su predicci√≥n debido a los patrones de error que existen.

**C√≥mo detectarlo** Previo a aplicaci√≥n de la prueba Durbin-Watson
debemos establecer una muestra para aplicarla. Esto debido a que de no
hacerlo, y al seleccionar una muestra aleatoria cada vez, el resultado
no ser√° el mismo siempre. Podemos lograr eso con `set.seed` del paquete
`car`.

La hip√≥tesis nula de esta prueba es que no hay dependencia de residuos;
por lo que para aprobar el supuesto necesitamos que el pvalue supere el
0.05.

a.  Test de Durbin Watson

```{r, message=FALSE, warning=FALSE}
set.seed(11)
durbinWatsonTest(modelo1,simulate = TRUE,reps = 1000)
```

el p-value de `durbinWatsonTest` es 0.262 **Al ser mayor a 0.05,
entonces podemos afirmar que los residuos son independientes** o que no
est√°n autocrrelacionados. El modelo **s√≠** pasa este supuesto.

# **Modelo 2:** ¬øEs posible mejorar mi modelo1? 

Realizamos una nueva regresi√≥n.

```{r}
names(Egov)
```

```{r, fig.show='hide',warning=FALSE,message=FALSE}

modelo2 <- Egov %>% lm(accesoInformacion ~ ProcesoElectoral  + Capital_Humano + UsuariosInternet,data=.)
summary(modelo2)

```

Seguimos nuestro flujograma para evaluar el modelo:

a.  Nos preguntamos si el modelo es v√°lido:

-   Si el p-value es menor a 0.05 significa que rechazamos la hip√≥tesis
    nula, lo cual probar√≠a que nuestro modelo s√≠ funciona. -Al tener un
    p-value de 2.2e-16 nuestro modelo s√≠ funciona.

b.  ¬øQu√© tanto explica el modelo? -Revisamos el R cuadrado que va de 0 a
    1 (0% a 100%) -En este caso mis variables (en conjunto) explican el
    89.8% de la variabilidad de mi dependiente, esto es bueno, pero
    quiz√° podr√≠a ser mejor.
c.  ¬øLas variables independientes aportan al modelo? -Nos enfocamos en
    el p-value de cada independiente -corroboramos que estas rechacen la
    hip√≥tesis nula, es decir que sean menores que 0.05.

Conclusiones preliminares: el modelo s√≠ pasa la evaluaci√≥n; mis
variables siguen aportando al modelo, mi modelo es v√°lido al tener un p
value de 2.2e-16; sin embargo, nos damos cuenta que mi modelo2 explica
menos que mi modelo1. Por lo tanto, solo al evaluar mi modelo2, a pesar
de que es un modelo v√°lido, optar√≠a por mantener mi modelo1. **Ojo, solo
bas√°ndome en esta primera evaluaci√≥n del modelo. Una decisi√≥n m√°s fina
ser√≠a al realizar mis pruebas de supuestos completa.**
