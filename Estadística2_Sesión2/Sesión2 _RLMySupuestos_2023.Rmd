---
title: "Sesi√≥n 2. RLM y Supuestos"
author: "Curso: Estad√≠stica para el an√°lisis pol√≠tico 2"
date: "Ciclo 2023-1"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
editor_options: 
  markdown: 
    wrap: 72
---

<br>

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%",fig.align="center"}
knitr::include_graphics("logoPUCP.png") 
```

# **Recordando la regresi√≥n lineal**

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("egov.png") 
```

El E-Government Development Index (EGDI) o √çndice de Desarrollo de
Gobierno Electr√≥nico es un indicador que mide el nivel de desarrollo de
los servicios gubernamentales en l√≠nea y la capacidad de los gobiernos
para utilizar las tecnolog√≠as de la informaci√≥n y la comunicaci√≥n (TIC)
para proporcionar servicios p√∫blicos eficientes y efectivos. Fue
desarrollado por la Divisi√≥n de Administraci√≥n P√∫blica y Desarrollo de
la ONU en colaboraci√≥n con la Universidad de las Naciones Unidas.

El EGDI se compone de tres dimensiones: el nivel de acceso a las
tecnolog√≠as de la informaci√≥n y la comunicaci√≥n (TIC), la disponibilidad
de servicios gubernamentales en l√≠nea y el grado de capacitaci√≥n y
compromiso del gobierno con el desarrollo de servicios en l√≠nea. El
√≠ndice se mide en una escala de 0 a 1, donde 1 representa el nivel m√°s
alto de desarrollo del gobierno electr√≥nico.

El EGDI es utilizado por los gobiernos, las organizaciones
internacionales y la sociedad civil para evaluar el progreso en el
desarrollo del gobierno electr√≥nico y para identificar las √°reas en las
que se deben hacer mejoras para proporcionar servicios p√∫blicos m√°s
eficientes y efectivos en l√≠nea.

Para mayor informaci√≥n:
<https://publicadministration.un.org/egovkb/en-us/About/Overview/-E-Government-Development-Index>

```{r,echo=FALSE, out.width="70%",fig.align="center", fig.cap = "Diccionario de datos de EGov.xlsx"}
knitr::include_graphics("DDatos_pd2.png") 
```

Obtenemos nuestra base de datos:

```{r}
library(rio)
Egov=import("EGov.xlsx")
names(Egov)
```

## Ejemplo 1: Regresi√≥n lineal simple

Calcularemos un modelo para *predecir el acceso a la informaci√≥n a
partir de participaci√≥n digital*.

-   Variable dependiente: accesoInformacion

-   Variable independiente: participaci√≥nDigital

```{r}
modeloRL = lm(accesoInformacion ~ participaci√≥nDigital, Egov)
summary(modeloRL)
```

Seguimos nuestro flujograma para evaluar el modelo:

1.  **Nos preguntamos si el modelo es v√°lido** ü§î
    -   Si el p-value es menor a 0.05 significa que rechazamos la
        hip√≥tesis nula, lo cual probar√≠a que nuestro modelo s√≠ funciona.
2.  **¬øQu√© tanto explica el modelo?**
    -   Revisamos el R cuadrado ajustado que va de 0 a 1 (0% a 100%)
3.  **Si la variable independiente aporta al modelo**
    -   Nos enfocamos en el p-value de cada independiente
4.  **Identificamos los coeficientes**
    -   En este caso hacemos uso del c√≥digo modelo1\$coefficients.

### ¬øQu√© sucede si agregamos m√°s variables?

```{r,echo=FALSE, out.width="40%",fig.align="center"}
knitr::include_graphics("esperanzaYoda.png") 
```

## Ejemplo 2: Regresi√≥n lineal m√∫ltiple

Calculamos nuestro modelo, en este caso usaremos lo siguiente:

-   Variable dependiente: accesoInformacion

-   Variables independientes: Capital_Humano + Policulture +
    Telecommunicacion_Infrastructura + ProcesoElectoral

```{r}
modelo1= lm(accesoInformacion ~ Capital_Humano + Policulture + Telecommunicacion_Infrastructura + ProcesoElectoral,Egov)
summary(modelo1)

```

Seguimos nuestro flujograma para evaluar el modelo:

1.  **Nos preguntamos si el modelo es v√°lido:**

-   Si el p-value es menor a 0.05 significa que rechazamos la hip√≥tesis
    nula, lo cual probar√≠a que nuestro modelo s√≠ funciona.
-   Al tener un p-value de 2.2e-1-16 nuestro modelo s√≠ funciona.

2.  **¬øQu√© tanto explica el modelo?**

-   Revisamos el R cuadrado ajustado que va de 0 a 1 (0% a 100%)

-   En este caso mis variables (en conjunto) explican el 91.8% de la
    variabilidad de mi dependiente, esto es bueno, pero quiz√° podr√≠a ser
    mejor üòØ

3.  **¬øLas variables independientes aportan al modelo?**

-   Nos enfocamos en el p-value de cada independiente

-   corroboramos que estas rechazen la hip√≥tesis nula, es decir que sean
    menores que 0.05.

-   Vemos que todas nuestras variables cumplen ‚úÖ

4.  **Identificamos los coeficientes**

-   En este caso hacemos uso del c√≥digo modelo1\$coefficients.

```{r}
#install.packages("lm.beta")
library(lm.beta)
modelo1$coefficients

```

-   Armamos nuestra ecuaci√≥n: y=-0.121108754+
    Capital_Humano(0.338730284)+....

# **SUPUESTOS**

### **1- Linealidad (el problema es la no linealidad)**

**Descrici√≥n** Como su nombre lo dice, debe de existir una linealidad
entre la variable independiente y dependiente, en otras palabras,la
linealidad indica que el valor esperado de la variable dependiente es
una funci√≥n lineal de cada variable independiente, manteniendo las dem√°s
fijas. La pendiente de esa l√≠nea no depende de los valores de las otras
variables, por ello tambi√©n nos fijamos variable por variable. Los
efectos de diferentes variables independientes sobre el valor esperado
de la variable dependiente son aditivos. Si este supuesto no se cumple
significar√≠a que posiblemente existan variables que no aporten al modelo
o que se trate de una relaci√≥n no lineal.

**C√≥mo detectarlo**

OPCI√ìN 1: Exploraci√≥n gr√°fica: Plot de valores residuales frente a
valores predichos.

OPCI√ìN 2: Calculando la correlaci√≥n bivariada de cada independiente con
la dependiente.

**C√≥digo e interpretaci√≥n**

```{r}
library(ggfortify)
#Exploraci√≥n gr√°fica
plot(modelo1,1)
autoplot(modelo1,1)
```

Usando el c√≥digo plot, la l√≠nea roja deber√≠a de estar lo m√°s cercana a
la l√≠nea punteada. De acuerdo al resultado, el gr√°fico a√∫n nos generar√≠a
suspicacias. En tanto, dado que la l√≠nea roja obedece a los puntos,
√©stos deber√≠an distribuirse alrededor de una l√≠nea horizontal, con una
varianza aproximadamente constante.

Si usamos la correlaci√≥n, entonces revisamos cada una de las
variables: - Nos fijamos en el p-value - Nos fijamos en el cor

```{r}
#Usando el test
cor.test(Egov$accesoInformacion, Egov$Capital_Humano)
cor.test(Egov$accesoInformacion, Egov$Policulture)
cor.test(Egov$accesoInformacion, Egov$Telecommunicacion_Infrastructura)
cor.test(Egov$accesoInformacion, Egov$ProcesoElectoral)
```

Al revisar todas las variables nos damos cuenta que todas tienen un
p-value menor a 0.05, lo cual nos da a conocer que s√≠ existe relaci√≥n
lineal. ¬øQu√© pasar√≠a si tuviese que sacar una variable?, ¬øCu√°l es la m√°s
cercana a "no cumplir"?

Tambi√©n lo puedes graficar para que te de una idea de forma m√°s r√°pida:

```{r}
#install.packages("corrplot")
names(Egov)
```

```{r}
library(corrplot)
#La funci?n cor calcula la matriz de correlaciones
M<-cor(Egov[,c(8,6,5,7,4)],method="pearson")
corrplot(M, method="circle",type="upper")
corrplot(M, method="number")
corrplot.mixed(M)
```

### **2. Normalidad de residuos (el problema es la NO normalidad)**

**Descrici√≥n**

Identificar si los errores siguen una distribuci√≥n normal. La resta del
valor observado menos el valor pronosticado (residuos) siguen una
distribuci√≥n normal, esto es importante porque si es que no se cumple no
se podr√≠an aplicar las pruebas globales del modelo.

**C√≥mo detectarlo**

Exploraci√≥n gr√°fica: QQ plot de residuos Pruebas de normalidad a los
residuos. Normalmente bastar√≠a con la prueba de Shapiro Wilk, pero
tambi√©n se pueden probar otros como Lillieford, Kolmogorov (no es muy
exigente), entre otros.

**C√≥digo e interpretaci√≥n**

Si usamos s√≥lo gr√°fico

```{r}
plot(modelo1, 2) #o tambi√©n se puede usar el c√≥digo autoplot(modelo1,2), las dos indicar√≠an lo mismo.
```

```{r}
library(ggfortify)
autoplot(modelo1,2)
```

Todos los puntos deben estar sobre la diagonal. Los dos gr√°ficos no son
concluyentes, entonces procedo a realizar el test.

Si usamos prueba de normalidad:aplicamos la prueba de Shapiro a los
residuos del modelo

```{r}
shapiro.test(modelo1$resid)
```

**Ojo con la hip√≥tesis nula**. H0: Es normal (distribuci√≥n normal) \|
Ha: No es normal (no hay distribuci√≥n normal)

Si el pvalor es menor a 0.05 entonces *NO existe normalidad de residuos*
(problemas!), se rechazar√≠a la distribuci√≥n normal. Dado que nuestro
p-value es 0.1378, mayor que 0.05, entonces s√≠ estamos frente a un caso
de distribuci√≥ normal de los residuos.

### **3- Homocedasticidad (el problema es la heterocedasticidad)**

**Descripci√≥n**

La homocedasticidad (tambi√©n conocido como homogeneidad en la varianza
de los residuos) indica que las variancias de los errores son
constantes. Cuando no se cumple es un problema porque los estimadores no
son consistentes ni eficientes y se presenta el caso de la
heterocedasticidad.

**C√≥mo detectarlo**

OPCI√ìN 1: Exploraci√≥n gr√°fica: diagrama de residuos standarizados y
valores predichos.

OPCI√ìN 2: Con el Score Test for Non-Constant Error Variance, tambi√©n
llamado Test Breusch Pagan. Eval√∫a si la varianza del error cambia con
el nivel de la variable respuesta (valores ajustados) o con una
combinaci√≥n lineal de predictores.

**C√≥digo e interpretaci√≥n**

Si usamos el gr√°fico

```{r}
plot(modelo1, 3)
```

En el Gr√°fico la l√≠nea roja debe seguir una tendencia horizontal, esto
representar√≠a que la distribuci√≥n de los puntos son uniformes. Al ver
nuestro gr√°fico nos damos cuenta que la l√≠nea roja va hacia arriba, lo
cual nos dice que el gr√°fico no es concluyente a√∫n. Vamos al test.

Si usamos el test de BP:

```{r message=FALSE, warning=FALSE}
library(lmtest)
bptest(modelo1)
```

H0: El modelo es homoced√°stico Ha: El modelo es heteroced√°stico

Si el pvalor es menor a 0.05 entonces el modelo es heteroced√°stico
(problema!). Esta vez estamos frente a un modelo homoced√°stico

### **4. Ausencia de multicolinealidad (el problema es la presencia de multicolinealidad)**

**Descripci√≥n**

Se aplica en la regresi√≥n lineal M√öLTIPLE. Significa que las variables
explicativas est√°n relacionadas linealmente entre s√≠. La
multicolinealidad hace que los coeficientes del modelo se vuelvan
inestables, es decir, oscilar√°n violentamente ante cambios m√≠nimos en
las variables de insumo. Esto entender√≠a que existe una relaci√≥n fuerte
entre variables independientes, por lo tanto podr√≠a darnos un modelo
inestable.

**C√≥mo detectarlo**

Con el Factor de Inflaci√≥n de Varianza (VIF). los factores de inflaci√≥n
de varianza deben de ser menores de 5. De acuerdo a nuestros resultados
no encontramos multicolinealidad.

**C√≥digo e interpretaci√≥n**

```{r}
library(DescTools)
VIF(modelo1)
```

Valores \> 5 indican presencia de multicolinealidad.

### 5.- **Independencia de residuos (el problema es que existe autocorrelaci√≥n en los residuos)**

**Descripci√≥n**

Si los errores residuales **no son independientes**, es probable que
demuestren alg√∫n tipo de patr√≥n (que no siempre es obvio a simple
vista).

**C√≥mo detectarlo**

Se puede realizar el Test de Durbin Watson (que mide el la presencia de
correlaci√≥n de cada error residual con el error residual "anterior")

**C√≥digo e interpretaci√≥n**

```{r message=FALSE, warning=FALSE}
#Default
library(car)
durbinWatsonTest(modelo1)
```

Durbin Watson: Las hip√≥tesis son: H0: Los residuos son independientes
Ha: Los residuos no son independientes Si el pvalor es menor a 0.05
entonces los residuos no son independientes o tambi√©n se podr√≠a decir
que est√°n **autocorrelacionados** (problema!). En este caso tenemos un p
value de 0.266, mayor a 0.05, el cual nos indica que no nos encontramos
frente a un caso de autocorrelaci√≥n.

**Modelo 2** ¬øEs posible mejorar mi modelo1? Esta vez, realizamos una
nueva regresi√≥n.

```{r}
modelo2 = lm(accesoInformacion ~ ProcesoElectoral + Policulture + Capital_Humano + UsuariosInternet,Egov)
summary(modelo2)
```

Seguimos nuestro flujograma para evaluar el modelo:

1.  Nos preguntamos si el modelo es v√°lido:

-   Si el p-value es menor a 0.05 significa que rechazamos la hip√≥tesis
    nula, lo cual probar√≠a que nuestro modelo s√≠ funciona. -Al tener un
    p-value de 2.62e-05 nuestro modelo s√≠ funciona.

2.  ¬øQu√© tanto explica el modelo? -Revisamos el R cuadrado ajustado que
    va de 0 a 1 (0% a 100%) -En este caso mis variables (en conjunto)
    explican el 61.7% de la variabilidad de mi dependiente, esto es
    bueno, pero quiz√° podr√≠a ser mejor.
3.  ¬øLas variables independientes aportan al modelo? -Nos enfocamos en
    el p-value de cada independiente -corroboramos que estas rechazen la
    hip√≥tesis nula, es decir que sean menores que 0.05.

Conclusiones preliminares: el modelo s√≠ pasa la evaluaci√≥n; mis
variables siguen aportando al modelo, mi modelo es v√°lido al tener un p
value de 2.2e-16; sin embargo, nos damos cuenta que mi modelo2 explica
menos que mi modelo1. Por lo tanto, solo al evaluar mi modelo2, a pesar
de que es un modelo v√°lido, optar√≠a por mantener mi modelo1. Ojo, solo
bas√°ndome en esta primera evaluaci√≥n del modelo. Una decisi√≥n m√°s fina
ser√≠a al realizar mis pruebas de supuestos completa.
