<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Pr√°ctica dirigida 1</title>

<script src="site_libs/header-attrs-2.23/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.0/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Pr√°cticas de Estad√≠stica 2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">Sobre el curso</a>
</li>
<li>
  <a href="pd1.html">Sesi√≥n 1</a>
</li>
<li>
  <a href="pd2.html">Sesi√≥n 2</a>
</li>
<li>
  <a href="https://karinaalc.github.io/Estadistica-2/">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Pr√°ctica dirigida 1</h1>

</div>


<div id="facultad-de-ciencias-sociales---pucp" class="section level2">
<h2>FACULTAD DE CIENCIAS SOCIALES - PUCP <br></h2>
</div>
<div id="tidyverse-y-rl" class="section level1">
<h1><strong>Tidyverse y RL</strong></h1>
<br>
<center>
<img src=" " width="200"/>
</center>
<p><img src="logoPUCP.png" width="30%" /></p>
<div id="jefes-de-pr√°ctica-karina-alc√°ntara-y-lizette-crisp√≠n"
class="section level3">
<h3>Jefes de Pr√°ctica: Karina Alc√°ntara üë©‚Äçüè´ y Lizette Crisp√≠n üë©‚Äçüè´<br></h3>
</div>
<div id="sesi√≥n-1---tidyverse-y-rl" class="section level3">
<h3><strong>SESI√ìN 1 - Tidyverse y RL</strong> <br></h3>
<p>============================================================</p>
</div>
<div id="mundo-tidyverse" class="section level3">
<h3><strong>MUNDO TIDYVERSE</strong></h3>
<p><img src="pd1_tidy.png" width="30%" style="display: block; margin: auto;" /></p>
<p>Tidyverse es un conjunto de de paquetes de R para ciencia de datos,
nos ayuda a trabajar las bases de datos. Ha sido desarrollado por
RStudio.</p>
<ul>
<li><p><strong>Es consistente</strong> : Todos los paquetes tienen una
misma estructura</p></li>
<li><p><strong>Concatenable</strong>: Siempre se pueden unir peque√±as
partes para resolverlos</p></li>
<li><p><strong>Funcional</strong>: Como casi todo R, promueve la
programaci√≥n</p></li>
</ul>
<p>Para cada paso de tratamiento de datos existe un paquete, se puede
pasar desde cargar/importar los datos, limpiarlos, transformarlos,
visualizar, modelarlos y finalmente comunicarlos.</p>
<p>Para importar datos tenemos readr, haven y readxl. Para limpiar los
datos usamos <em>tidyr</em>, para transofrmar los datos se usa dyplr,
que lo veremos a continuaci√≥n, para modelar se usa purr o broom, para
visualizar se usa ggplot2. Finalmente, para comunicar se usa knitr para
publicar los resultados por html, pdf, ppt. y rmarkdown es la estructura
de knitr.</p>
<p>Algunos les gusta usarlo porque facilita el an√°lisis y manipulaci√≥n
de datos y es m√°s r√°pido, pero, por otro lado, tiene otra l√≥gica en la
programaci√≥n. En vez de usar ‚Äú,‚Äù para diferenciar entre comandos, usar
%&gt;%,</p>
<p>Instalando el paquete de tidyverse te incluye los 8 paquetes. Pero,
eso s√≠, toma m√°s tiempo de lo debido. Por eso, en esta ocasi√≥n, se ha
descargado los que necesitaremos ahora</p>
<pre class="r"><code>#  Paquetes que se usar√°n #
library(dplyr)
library(ggplot2)
library(data.table)
library(devtools)
library(foreign)
library(rio)</code></pre>
<div id="importar-y-preparar-base-de-datos" class="section level4">
<h4>Importar y preparar base de datos</h4>
<pre class="r"><code>usa &lt;- read.spss(&quot;usa.sav&quot;,
          use.value.labels = T, 
          to.data.frame=TRUE)
str(usa)#Ver estructura de bases de datos, tipo de variable
#View(usa) #Ver base de datos </code></pre>
<p>PAQUETE DPLYR</p>
<p>El paquete dplyr es el m√°s √∫til en R para la manipulaci√≥n de datos,
una de las ventajas es que se pueda usar el pipe para combinar
diferentes funciones en R. Para no tener que escribirlo, se genera
mediante control shift M. En pocas palabras, reemplaza la ‚Äú,‚Äù para
concatenar(unir) varios comandos.</p>
</div>
</div>
<div id="filter-filtrar-filas-seg√∫n-un-criterio" class="section level3">
<h3><strong>FILTER</strong>: filtrar filas seg√∫n un criterio</h3>
<p>Filtra casos o filas que cumplen con el criterio. Por ejemplo, aca
estamos filtrando de la data usa las personas que son jud√≠os</p>
<pre class="r"><code>filter(usa, relig==&quot;Judio&quot;, intecamp==&quot;1. Mucho&quot;) 

filter(usa, edad &gt;= 50)

filter(usa, intecamp==&quot;1. Mucho&quot;, sexo==&quot;Hombre&quot;, consipol==&quot;1. Muy liberal&quot;)

filter(usa, intecamp==&quot;1. Mucho&quot;, sexo==&quot;Mujer&quot;, consipol==&quot;7. Muy Conservador&quot;)</code></pre>
</div>
<div id="select-seleccionando-subconjunto-de-variables"
class="section level3">
<h3><strong>SELECT</strong>: Seleccionando subconjunto de variables</h3>
<p>Selecciona columnas o mejor dicho, variables de su conjunto de datos,
seg√∫n nombre.</p>
<p>En este comando estamos especificando que queremos seleccionar de la
data usa, las variables inter√©s en las campa√±as (intecamp) y sexo.</p>
<pre class="r"><code>inte&lt;-select(usa, intecamp, sexo)
inte</code></pre>
<p>Si queremos quitar variable ponemos el signo de menos. Salen todas
las varibales menos las del si voto en las elecciones del 96 (voto96) y
por qui√©n.</p>
<p>Lo podr√≠amos volver un objeto para poder trabajar con ello</p>
<pre class="r"><code># quitando variables
select(usa, -voto96, -quien96)
menos96 &lt;- select(usa, -voto96, -quien96)
menos96 </code></pre>
</div>
<div id="summarise-crear-resumenes-de-datos" class="section level3">
<h3><strong>SUMMARISE</strong>: Crear resumenes de datos</h3>
<p>Resume cualquiera de las funciones anteriores, para aplicarla a un
grupo de datos.</p>
<p>En este caso, queremos sacar el promedio de aprobaci√≥n de Al Gore
luego de su gesti√≥n. Para eso usamos sumarise. Mencionamos los datos de
la base usa, luego la variable que se crear√° en base a ella, que ser√° la
media de la variable gorepst, omitiendo los valores perdidos</p>
<p>Solo con variables num√©ricas (ojo)</p>
<pre class="r"><code>#Promedio aprobaci√≥n Al Gore post elecciones
summarise(usa, promgorepost = mean(gorepst, na.rm = T))
#CORROBORAMOS
class(usa$gorepst) </code></pre>
<p>Ac√° nos menciona un error, dice que el argumento no es num√©rico. Las
convertimos</p>
<pre class="r"><code>#CORREGIMOS
usa$gorepst&lt;- as.numeric(usa$gorepst)
usa$gorepre&lt;- as.numeric(usa$gorepre)

summarise(usa, promgorepost = mean(gorepst, na.rm = T))</code></pre>
</div>
<div id="count-contar-casos-en-base-a-una-variable"
class="section level3">
<h3><strong>COUNT</strong>: contar casos en base a una variable</h3>
<p>Nos ayuda a contar las observaciones.</p>
<p>Vamos a contar los casos de las personas de acuerdo al nivel
educativo.</p>
<p>Se puede observar que la mayor√≠a tiene un nivel educativo mayor al de
secundaria.</p>
<pre class="r"><code>count(usa, relig)
count(usa, educ, sort = F) #numero de personas en base a nivel educativo, con SORT=T estamos diciendo que nos ordene los datos de manera descendente</code></pre>
</div>
<div id="mutate-y-arrange" class="section level3">
<h3><strong>MUTATE Y ARRANGE</strong></h3>
<p>Crea nuevas columnas conservando las variables existentes. En esta
ocasi√≥n estamos creando una nueva variable que vendr√≠a a ser la
diferencia de la aprobaci√≥n de Al Gore antes y luego de su gesti√≥n.</p>
<p>Esta funci√≥n es un poco m√°s larga, pero no es dif√≠cil. Primero
crearemos una nueva variable que ser√° la diferencia de la aprobaci√≥n de
Al Gore antes y luego de su gesti√≥n, y luego de eso, queremos que esa
variable creada, se ordene de manera descendente. Finalmente, queremos
que los resultados muestre √∫nicamente las variables de ID, difgore,
gorepre y gorepst para ver la diferencia.</p>
<pre class="r"><code>usagoredesc&lt;-mutate(usa, difgore =  gorepst - gorepre) %&gt;%
  arrange(., desc(gorepst)) %&gt;%
  select(., id, difgore, gorepre, gorepst)</code></pre>
</div>
</div>
<div id="viewusagoredesc-para-corroborar-que-se-agreg√≥-la-variable"
class="section level1">
<h1>View(usagoredesc), para corroborar que se agreg√≥ la variable</h1>
<pre class="r"><code>#de manera ascendente
usagoreasc &lt;- mutate(usa, difgore =  gorepst - gorepre) %&gt;%
  arrange(.,difgore) %&gt;%
  select(., id, difgore, gorepre, gorepst)</code></pre>
<p>#View(usagoreasc)</p>
<p>Vamos a poner gorepost como funci√≥n en arrange para ver su aprobaci√≥n
m√°s alta.</p>
<pre class="r"><code>#diferencia m√°s alta
mutate(usa, difgore =  gorepst - gorepre) %&gt;%
  arrange(., desc(difgore))  %&gt;%
  select(., id, difgore, gorepre, gorepst)</code></pre>
<div id="transmute" class="section level3">
<h3><strong>TRANSMUTE</strong></h3>
<p>Tambi√©n existe la funci√≥n transmute, que realiza lo mismo solo que
muestra √∫nicamente la nueva variable creada (no se agrega a la base de
datos)</p>
<p>Crearemos la vida variable de disfrencia pero con la aprobaci√≥n
George Bush</p>
<p>Vamos a cambiarla a num√©rica, para evitar que ocurra el mismo
error.</p>
<pre class="r"><code>usa$gbushpst&lt;- as.numeric(usa$gbushpst)
usa$gbushpre&lt;- as.numeric(usa$gbushpre)

usabush&lt;-transmute(usa, difbush = gbushpst - gbushpre) %&gt;%
  arrange(., desc(difbush))</code></pre>
<p>#View(usabush)</p>
</div>
<div id="group_by-agrupar-datos" class="section level3">
<h3><strong>group_by</strong>: Agrupar datos</h3>
<p>Agrupa diferentes observaciones de manera que el conjunto de datos
original no cambie.</p>
<p>Aca estamos indicando que se agrupe la data en base a posici√≥n
pol√≠tica.</p>
<p>Finalmente, agruparemos datos y usaremos m√°s de una funci√≥n</p>
<p>En el primer ejemplo, lo que haremos es agrupar los datos mediante la
posici√≥n pol√≠tica, y usaremos sumarise para sacar el promedio de la
aprobaci√≥n de Bush post gesti√≥n Vemos los resultados. Vemos una
tendencia que los m√°s conservadores ten√≠an una aprobaci√≥n m√°s alta de
Bush</p>
<pre class="r"><code>usa.g &lt;- usa%&gt;% 
  group_by(.,) %&gt;% 
  summarise(mean = mean(gbushpst,na.rm=TRUE), n = n())
usa.g</code></pre>
<p>Ahora con Al Gore ¬ølos datos se voltean no? Los encuestados que se
consideran muy Liberales, aprueban m√°s la gesti√≥n de AlGore, a
diferencia de los muy conservadores.</p>
<pre class="r"><code>usa.b &lt;- usa%&gt;% 
  group_by(., consipol) %&gt;% 
  summarise(mean = mean(gorepst,na.rm=TRUE), n = n())
usa.b</code></pre>
</div>
<div id="repaso-modelo-lineal-general-m√∫ltiple" class="section level2">
<h2><strong>REPASO MODELO LINEAL GENERAL M√öLTIPLE</strong></h2>
<p>Recordemos que con los modelos buscamos medir el efecto de un
conjunto de variables independientes sobre una dependiente y tambi√©n con
el modelo creado predecir.</p>
<p>En este modelo es indispensable contar con una variable dependiente
num√©rica continua.</p>
<p>Como se mencion√≥ en la clase anterior, para obtener el mejor modelo
con la recta que capte la mayor√≠a de las coordenadas, se realizaba el
m√©todo de los m√≠nimos cuadrados (el cual ya es calculado por R).</p>
<p>Como no todo es perfecto, para poder realiar este m√©todo, se tienen
que cumplir 5 supuestos, y as√≠ asegurar que el modelo que creemos sea
estable y pueda predecir correctamente.</p>
<p>Para poder repasar nuevamente los pasos de an√°lisis y los requisito
usaremos la base de datos de la clase pasada, que conten√≠a variables
sobre los casos de COVID a nivel regional, y otras variables
sociodemogr√°ficas, econ√≥micas etc.</p>
</div>
<div id="regresi√≥n-lineal" class="section level2">
<h2>Regresi√≥n Lineal</h2>
<div id="ejemplo-1-prediciendo-los-casos-de-covid-19"
class="section level3">
<h3>Ejemplo 1: Prediciendo los casos de COVID-19</h3>
<p>Obtenemos nuestra base de datos:</p>
<pre class="r"><code>library(rio)
competitividad&lt;-import(&quot;COVID - COMPETITIVIDAD.sav&quot;)
names(competitividad)</code></pre>
</div>
<div id="recordando-la-regresi√≥n-lineal" class="section level3">
<h3>RECORDANDO LA REGRESI√ìN LINEAL</h3>
<p>Calcularemos un modelo para predecir los casos de COVID-19 a partir
del gasto real por hogar mensual</p>
<p>Variable dependiente: Casos COVID-19 por cada 100 mil personas</p>
<p>Variable independiente: gasto real por hogar mensual (var5)</p>
<pre class="r"><code>modelo &lt;-lm(competitividad$casos_100k ~ competitividad$var5)
summary(modelo)</code></pre>
<p>Seguimos nuestro flujograma para evaluar el modelo:</p>
<ol style="list-style-type: decimal">
<li>Nos preguntamos si el modelo es v√°lido</li>
<li>Qu√© tanto explica el modelo</li>
<li>Si la variable independiente aporta al modelo</li>
<li>Identificamos los coeficientes</li>
</ol>
<p>¬øQu√© sucede si ahora agregamos m√°s variables?</p>
<p>Calculamos nuestro modelo, en este caso usaremos lo siguiente:</p>
<p>Variable dependiente: Casos COVID-19 por cada 100 mil personas
Variables independientes: Stock de capital por trabajador (var3) + gasto
real por hogar mensual (var5) + morbilidad (var20).</p>
<pre class="r"><code>modelo1 &lt;- lm(competitividad$casos_100k~ competitividad$var3+competitividad$var5+
                competitividad$var20)
summary(modelo1)</code></pre>
<p>Seguimos nuestro flujograma para evaluar el modelo:</p>
<ol style="list-style-type: decimal">
<li>Nos preguntamos si el modelo es v√°lido</li>
<li>Qu√© tanto explica el modelo</li>
<li>Si las variables independientes aportan al modelo</li>
<li>Identificamos los coeficientes</li>
</ol>
<pre class="r"><code>modelo1$coefficients</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Construimos la ecuaci√≥n</li>
</ol>
<hr />
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
