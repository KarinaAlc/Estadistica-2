---
title: "Conglomerados"
output:
  pdf_document:
    latex_engine: lualatex
    toc: true
  fontfamily: "Apple Color Emoji"
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 2
    theme: simplex
    highlight: kate
    always_allow_html: yes
    code_folding: show
editor_options: 
  markdown: 
    wrap: 72
---
<br>

<center><img src=" " width="200"/></center>
```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r,echo=FALSE, out.width="30%",fig.align="left"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP** <br>

## Curso: POL 304 - Estad√≠stica para el an√°lisis pol√≠tico 2 \| Semestre 2023 - 2

<br>

#### Jefas de Pr√°ctica: Karina Alc√°ntara üë©‚Äçüè´ y Lizette Crisp√≠n üë©‚Äçüè´<br>

<br> <br>

# **Cluster jer√°rquico**

<br> <br>

## Paso 1. Preparaci√≥n de variables

```{r echo = T, results = 'hide',  fig.show='hide', message=FALSE}
library(rio)
data<- import("desigualdad.xlsx")
names(data)
```
Vamos a usar una base que tiene diferentes indicadores relacionados a desigualdad de g√©nero, utilizaremos desde MLautonomia hasta Cuenta F

  + DesigualdadGenero: Indice de desigualdad de g√©nero
  
  + MLAutonomia: Mide que tanto el sistema legal protege derechos reporductivos de las mujeres
  
  + MLViolencia: Mide que tanto el sistema legal protege a las mujeres de la violencia
  
  + VozPol√≠tica: Presencia de mujeres en el parlamento
  
  + LibertadMov: Porcentaje de mujeres que declaran no sentirse seguras en las calles
  
  + DesconfianzaSJ: Porcentaje de mujeres que no confian en el sistema de justicia
  
  + SecundariaC: Porcentaje de poblaci√≥n con secundaria completa
  
  + DesempleoMuj: Ratio de desempleo de muejeres frente a hombres
  
  + CuentaF: Porcentaje de mujeres que cuentan con una cuenta en el sistema financiero

Vamos a preparar la base 

```{r , message=FALSE}
rownames(data) <- data[,1]
#Asignamos las filas (casos) de acuerdo a la primera columna que era pa√≠ses
```


```{r ,message=FALSE}
library(dplyr)
data1 <- select(data, -Pais, -DesigualdadGenero)
#Mencionamos que queremos todas las variables menos la 1 (que es pa√≠s) y 2 (que es el indicador general)
data1<-na.omit(data1)
```

Exploramos la clasificaci√≥n de todas las variables
```{r , message=FALSE}
summary(data1)
```

## Paso 2. C√°lculo de matriz distancias

```{r, message=FALSE}
library(factoextra)
library(ggplot2)
m.distancia <- get_dist(data1, method = "euclidean", stand = TRUE)
```



Vemos la matriz de distancia
```{r , message=FALSE}
fviz_dist(m.distancia,gradient = list(low="blue", mid="white", high ="red"))
```


## Paso 3. Calculo de cl√∫ster

```{r , message=FALSE}
library(NbClust)
resnumclust=NbClust(data1, distance = "euclidean", min.nc= 2, max.nc= 10, 
                       method = "ward.D")

```


## Paso 4. Observamos el dendograma
```{r , message=FALSE}
#Aca especificamos el n√∫mero de clusters que deseamos
res1 <- hcut(data1, k = 4, stand = TRUE, hc_method = "ward.D")
#Ward: se va agrupando de acuerdo a las menores distancias
```

 **Dendograma**
```{r , warning=FALSE}
#comando de gr√°fico
#rect= agregar rectangulo punteado
#cex=Tama√±o del titulo
fviz_dend(res1, rect = T, cex = 0.5)

```

Gr√°ficamos los clusters
```{r , message=FALSE}
fviz_cluster(res1, data = data1)
```

## Paso 5. Ver caracter√≠sticas de los grupos


```{r , message=FALSE}
data$clus=as.factor(res1$cluster) #Agregamos la asignaci√≥n a la base de datos inicial
```

```{r, message=FALSE}
table(data$clus)
```

```{r , message=FALSE}
library(dplyr)
clust_car<-data1 %>%
  mutate(Cluster = res1$cluster) %>%
  group_by(Cluster) %>%
  summarise_all("mean")
clust_car
```

# **Cluster NO jer√°rquico**

Base de datos: Indicadores de ENDES 2019

Variables que se usar√°n son de indicadores ENDES 2019 relacionados a violencia f√≠sica contra la mujer y sus hijas/os

Haremos un indicador sobre violencia f√≠sica contra la mujer.

  + psico-esp: VIOLENCIA PSICOL√ìGICA EJERCIDA ALGUNA VEZ POR EL ESPOSO O COMPA√ëERO

  + fisica-esp:	VIOLENCIA F√çSICA EJERCIDA ALGUNA VEZ POR EL ESPOSO O COMPA√ëERO

  + sexual-esp:	VIOLENCIA  SEXUAL EJERCIDA ALGUNA VEZ POR EL ESPOSO O COMPA√ëERO

  + fisica-otros:	VIOLENCIA F√çSICA EJERCIDA ALGUNA VEZ POR OTRA PERSONA, APARTE DE SU ACTUAL/√öLTIMO ESPOSO
  
  + con-alcohol:Esposo / Compa√±ero  toma o tomaba bebidas alcoh√≥licas algunas veces o con frecuencia

  + golpes-hija	GOLPES O CASTIGOS F√çSICOS EJERCIDOS POR EL PADRE BIOL√ìGICO A SUS HIJAS E HIJOS

  + fisica-preshija:	MUJERES DE 15 A 49 A√ëOS DE EDAD QUE DECLARARON LA PRESENCIA DE SUS HIJAS/OS DE 1 A 5 A√ëOS DE EDAD CUANDO SU ESPOSO O COMPA√ëERO LA MALTRATABA FISICAMENTE

  + sexual-preshija	MUJERES DE 15 A 49 A√ëOS DE EDAD QUE DECLARARON LA PRESENCIA DE SUS HIJAS/OS DE 1 A 5 A√ëOS DE EDAD CUANDO SU ESPOSO O COMPA√ëERO LA MALTRATABA SEXUALMENTE

  + vio-hijamadre:	MUJERES DE 15 A 49 A√ëOS DE EDAD QUE DECLARARON QUE SU PAP√Å GOLPE√ì ALGUNA VEZ A SU MAM√Å 
  
Cargamos paquetes
```{r echo = T, results = 'hide',  fig.show='hide'}
library(dplyr)
library(cluster)
library(factoextra)
library(NbClust)
library(tidyr)
```


Cargamos data

```{r }
library(rio)
data= import("INDICADORES-ENDES.xlsx")
names(data)
```

Preparamos variables y vamos a hacer lo mismo que el ejercicio anterior. 

```{r }
rownames(data) = data[,1]
#Asignamos los nombres de acuerdo a la primera columna que es regiones, el 1 es de acuerdo a la posici√≥n
```


Eliminamos la variable regi√≥n porque ya tenemos las etiquetas 
```{r }
data = data[,-1]
#Mencionamos que queremos todas las variables menos la 1 
str(data)
```

¬øQu√© variables seleccionamos?


```{r }
library(dplyr)
data1=select(data, "psico-esp","fisica-esp","sexual-esp", "fisica-otros","con-alcohol")
```

En este caso como tenemos indicadores en la escala de % del 0 al 100, no necesitamos estandarizar



## Paso 1.  Calculamos distancias y elaboramos matriz de distancias

Calculamos distancias
```{r }
m.distancia <- get_dist(data1, method = "euclidean") 
```

Elaboramos matriz de distancias
```{r }
fviz_dist(m.distancia, gradient = list(low = "blue", mid = "white", high = "red"))
```


## Paso 2. Estimar el n√∫mero de cl√∫sters
Especificar que el metodo es **kmeans**
```{r }
resnumclust<-NbClust(data1, distance = "euclidean", min.nc=2, max.nc=10, method = "kmeans", index = "alllong")

```

- ¬øQu√© nos sugiere el gr√°fico?  
- ¬øCu√°ntos cl√∫ster podemos hacer? 
- ¬øCu√°l es la segunda opci√≥n?

## Paso 3. Calculamos los cl√∫sters con el m√©todo de k-means

```{r }
k1 <- kmeans(data1, centers = 2, nstart = 25)
```

## Paso 4. Graficamos cl√∫sters

Graficamos cl√∫sters
```{r }
fviz_cluster(k1, data = data1, ellipse.type = "norm",palette = "Set2", ggtheme = theme_minimal())
```

## Paso 5. Ver caracter√≠sticas de los grupos

Agregamos a la base de datos
```{r }
data1$clus<-as.factor(k1$cluster)
```

Observamos caracter√≠sticas

```{r }
tabla<-data1 %>%
  mutate(Cluster = k1$cluster) %>%
  group_by(Cluster) %>%
  summarise_all("mean")
tabla
```

¬øC√≥mo podemos determinar las categor√≠as de ambos conglomerados?

Los valores de abajo tienden a ser m√°s altos en cuanto a violencia f√≠sica

- 2=Nivel bajo de violencia f√≠sica hacia la mujer

- 1=Nivel alto de violencia f√≠sica hacia la mujer

```{r}
data1$clus=as.factor(data1$clus)
levels(data1$clus)=c("Alto","Bajo")
table(data1$clus)
```


