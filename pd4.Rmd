---
title: "Sesi√≥n Multinomial"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 1
    theme: simplex
    highlight: kate
    always_allow_html: yes
    code_folding: show
  fontfamily: "Apple Color Emoji"
  pdf_document:
    latex_engine: lualatex
    toc: yes
    toc_depth: '1'
---

<br>

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%",fig.align="left"}
knitr::include_graphics("logoPUCP.png") 
```

## **FACULTAD DE CIENCIAS SOCIALES - PUCP** <br>

### Curso: POL 304 - Estad√≠stica para el an√°lisis pol√≠tico 2 \| Semestre 2023 - 2

<br>

#### Jefas de Pr√°ctica: Karina Alc√°ntara üë©‚Äçüè´ y Lizette Crisp√≠n üë©‚Äçüè´<br>

<br>


## Base de Datos

La base de datos a trabajar combina los datos obtenidos en el Democracy Index (https://en.wikipedia.org/wiki/Democracy_Index) y el Index of Economic Freedom (https://en.wikipedia.org/wiki/Index_of_Economic_Freedom). Lo que veremos en esta clase es la relaci√≥n entre el tipo de r√©gimen pol√≠tico (democracia, democracia fallida y dictadura) con algunas variables econ√≥micas.

Todo esto para comprobar el supuesto: *¬øuna econom√≠a liberal influye en el nivel de democracia?*

Exploremos la data:

```{r}
library(rio)
demofree=import("https://github.com/schrodingercase/primary/raw/master/demofree.xlsx")
str(demofree) #Ver estructura de la base de datos
```

### Pregunta de investigaci√≥n

**¬øExiste alguna relaci√≥n entre el tipo de r√©gimen pol√≠tico y las variables "Trade freedom" sistema econ√≥mico con mayor libertad de comercio y "Property Rights" Derecho a la propiedad privada?**

- VD= Regimen Pol√≠tico

- VI= Trade Freedom (Sistema econ√≥mico con mayor libertad) y Property Rights (Derecho a la propiedad privada)
 

## PASO 1: Preparar la data 

###  1.1: Limpieza de data e identificaci√≥n de las variables

```{r}
demofree$regimen=demofree$`Regime type`
demofree$property=demofree$`Property Rights`
demofree$tradefree=demofree$`Trade Freedom`
```

Eliminamos casos perdidos

```{r}
demofree = demofree[complete.cases(demofree$regimen),]
```

Ahora comencemos a dar formato

<br>
 
Comencemos con la variable dependiente:
```{r}
library(car)
table(demofree$regimen)
```

Ojo, con Hybrid regime y Flawed democracy
```{r}
demofree$regimen = recode(demofree$regimen, "'Full democracy' = 3; 'Hybrid regime' = 2; 'Flawed democracy' = 2; 'Authoritarian' = 1")
table(demofree$regimen)
```

Volvemos factor la variable para poder etiquetarla nuevamente
```{r}
demofree$regimen=as.factor(demofree$regimen)
levels(demofree$regimen)=c("Dictadura","Democracia fallida","Democracia")
```

```{r}
table(demofree$regimen)
```

```{r}
demofree$property<-as.numeric(demofree$property)
demofree$tradefree<-as.numeric(demofree$tradefree)
```

### 1.2: ELEGIR NUESTRA L√çNEA DE BASE

La l√≠nea de base o baseline sirve para tener una referencia al interpretar los resultados del modelo. En este caso nuestra dependiente fue recodificada en "Democracia","Democracia fallida","Dictadura". Entonces, "Democracia fallida" al estar en el medio es nuestra baseline.

Verificamos qu√© ha considerado R

```{r}
contrasts(demofree$regimen)
```

Con el siguiente  comando establecemos la categor√≠a de referencia. en *ref* mencionamos c√≥mo se llama esta categor√≠a, por eso es importante tener bien etiquetadas las variables.


```{r}
library(reshape2)
demofree$regimen <- relevel(demofree$regimen , ref = "Democracia fallida")
```


## PASO 2: MODELO LOG√çSTICO 

### 2.1 REALIZAR EL MODELO LOG√çSTICO 

No olvidemos cual es nuesta l√≠nea de base para la interpretaci√≥n.
```{r}
library(nnet)
mod1 <- multinom(regimen ~ property + tradefree, data = demofree)
summary(mod1)
```
<<<<<<< HEAD

=======
>>>>>>> e9cc0000d5268f09e5606a92331b853eb1684a57

### 2.2: RELACI√ìN DE LAS VARIABLES

Un primer paso ser√≠a ver el signo de los coeficientes para determinar la relaci√≥n entre la variable independiente y la variable dependiente

**Derechos de propiedad**

- Coeficiente (dictadura) :-0.02654594

<<<<<<< HEAD
Si un pa√≠s incrementa 1 punto en el √≠ndice de derecho a la propiedad es 0.0262 menos probable que el estado sea dictadura a demoracia fallida.
=======
Si un pa√≠s aumenta en un punto el indicador de derechos a la propiedad, la probabilidad de que sea dictadura a que sea democracia fallidad disminuye

>>>>>>> e9cc0000d5268f09e5606a92331b853eb1684a57
----
- Coeficiente (democracia): 0.15297576

 Si un pa√≠s aumenta en un punto el indicador de derechos a la propiedad, la probabilidad de que sea democracia a que sea democracia fallida aumenta


**Libertad econ√≥mica**

- Coeficiente(dictadura) :-0.07105396

 Si un pa√≠s aumenta en un punto indicador de libre comercio, la probabilidad de que sea dictadura a que sea democracia fallida disminuye.

----
- Coeficiente(democracia):0.01435271

 Si un pa√≠s aumenta en un punto el indicador de libre comercio, la probabilidad de que sea democracia a que sea democracia fallida aumenta

### 2.3: Aplicando la ecuaci√≥n

#### Recordamos la ecuaci√≥n y realizamos un ejemplo

#INSERTAR PNG DE ECUACI√ìN (elegir la adecuada)

Usamos los valores de 50 (property) y 60 (tradefree)

prob dictadura
```{r}
numeDct<-exp(6.015109-0.02654594*50-0.07105396*60)
denomDct<-1+numeDct
ProbDct<-numeDct/denomDct
ProbDct
```

prob democracia
```{r}
numDemo= exp(-13.772977)*(exp(0.15297576*50)*exp(0.01435271*60))
denomDemo=1+numDemo
ProbDemo=numDemo/denomDemo
ProbDemo
```
¬øProbabilidad de la democracia fallida?


#insertar imagen de: 
demfallida=1-probdictadura-probdemocracia <3


### 2.4: SIGNIFICANCIA DE LAS VARIABLES

```{r}
#install.packages("RVAideMemoire")
library(RVAideMemoire)
test.multinom(mod1,property) # Se coloca test.multinom(nombredelmodelo,variableindependiente1)
```

```{r}
test.multinom(mod1,tradefree)
# Se coloca test.multinom(nombredelmodelo,variableindependiente2)
```

## PASO 3: INTERPRETACI√ìN DE COEFICIENTES OJO, USEMOS MARGINAL EFFECTS

```{r}
library(marginaleffects)
Marg1=marginaleffects(mod1,type = "probs")
summary(Marg1)[c(1,2,4)]   
```

#### Recordamos la ecuaci√≥n y realizamos un ejemplo

#INSERTAR PNG DE ECUACI√ìN

Usamos los valores de 50 (property) y 60 (tradefree)

prob dictadura
```{r}
Num1<-exp(6.118423-0.02654594*50-0.07105396*60)
Deno1<-1+Num1
ProbDictadura<-Num1/Deno1
ProbDictadura
```

prob democracia
```{r}
Num2= exp(-13.772977)*(exp(0.15297576*50)*exp(0.01435271*60)*exp(-1.0531380*1))
Deno2=1+Num2
ProbDemo=Num2/Deno2
ProbDemo
```

```{r}
1-(ProbDictadura+ProbDemo)
```

------------------------------
### MODELO 2


¬øQu√© sucede si a√±adimos a nuestras variables independientes una categ√≥rica?

La libertad comercial (Business Freedom) es muchas veces reconocida como una variable indispensable en toda democracia. ¬øCu√°nto afectar√≠a al modelo?
Vamos a crear un modelo agregando esta variable al modelo

## PASO 1 PREPARACI√ìN DE DATA

Cambiamos el nombre de la variable
```{r}
demofree$busfree=demofree$`Business Freedom`
```

La volvemos num√©rica porque tbm es un indicador num√©rico pero la volveremos dummy para as√≠ poder analizarla como categ√≥rica.
```{r}
demofree$busfree = as.numeric(demofree$busfree)
summary(demofree$busfree)
```

Pero,para fines pr√°cticos, dividamos esta variable en pa√≠ses con poca libertad comercial y con mucha libertad comercial.

Libertad comercial Poca
Libertad comercial Mucha
```{r}
demofree$busfreef = ifelse(demofree$busfree<=74.50, "Poca", "Mucha")
table(demofree$busfreef)
```


##### Volvemos  "Dummy"

Utilizamos el paquete fastDummies para dicotomizar las variables, en select_columns indicamos qu√© variable queremos dicotomizar

```{r}
library(fastDummies)
demofree=dummy_cols(demofree, select_columns = c("busfreef"))
```

```{r}
names(demofree)
```

```{r}
table(demofree$busfreef_Poca)
```

```{r}
table(demofree$busfreef_Mucha)
```

## PASO 2: MODELO LOG√çSTICO

```{r}
library(nnet)
mod2<- multinom(regimen ~ property + tradefree + busfreef_Poca, data = demofree)
summary(mod2)
```

##PASO 3: RELACI√ìN DE LAS VARIABLES


**Derechos de propiedad**

- Coeficiente (dictadura) :-0.03774142

Si un pa√≠s aumenta en un punto el indicador de derechos a la propiedad, la probabilidad de que sea dictadura a que sea democracia fallidad disminuye

----
- Coeficiente (democracia): 0.14741855

 Si un pa√≠s aumenta en un punto el indicador de derechos a la propiedad, la probabilidad de que sea democracia a que sea democracia fallida aumenta


**Libertad econ√≥mica**

- Coeficiente(dictadura) :-0.07454554

 Si un pa√≠s aumenta en un punto indicador de libre comercio, la probabilidad de que sea dictadura a que sea democracia fallida disminuye
----
- Coeficiente(democracia):0.01448272

 Si un pa√≠s aumenta en un punto el indicador de libre comercio, la probabilidad de que sea democracia a que sea democracia fallida aumenta

**Poca libertad de comercio**

- Coeficiente(busfreef_Poca): -1.0531380

Cuando un pa√≠s s√≠ tiene poca libertad de comercio (es 1), la probabilidad de que sea democracia fallida a que sea dictadura disminuye.

----
- Coeficiente(busfreef_Poca): -0.2906452

Cuando un pa√≠s s√≠ tiene poca libertad de comercio (es 1), la probabilidad de que sea democracia fallida a que sea democracia disminuye.

### 3.1: SIGNIFICANCIA DE LAS VARIABLES

```{r}
#install.packages("RVAideMemoire")
library(RVAideMemoire)
test.multinom(mod2,property) # Se colocar test.multinom(nombredelmodelo,variableindependiente1)
```

```{r}
test.multinom(mod2,tradefree)
# Se coloca test.multinom(nombredelmodelo,variableindependiente2)
```

## PASO 4: INTERPRETACI√ìN DE COEFICIENTES OJO, USEMOS MARGINAL EFFECTS

```{r}
library(marginaleffects)
Marg2=marginaleffects(mod2,type = "probs")
summary(Marg2)[c(1,2,4)]   
```

#### Recordamos la ecuaci√≥n y realizamos un ejemplo

#INSERTAR PNG DE ECUACI√ìN

Usamos los valores de 50 (property), 60 (tradefree) y si hay poca libertad de comercio (1)

prob dictadura
```{r}
Num1<-exp(7.719501-0.037741424*50-0.07454554*60-1.0531380*1)
Deno1<-1+Num1
ProbDictadura<-Num1/Deno1
ProbDictadura
```

prob democracia
```{r}
Num2= exp(-13.207954)*(exp(0.14741855*50)*exp(0.01448272*60)*exp(-0.2906452*1))
Deno2=1+Num2
ProbDemo=Num2/Deno2
ProbDemo
```

prob demo fallida
```{r}
1-(ProbDictadura+ProbDemo)
```


## PASO 5: COMPARAR Y ELEGIR MODELOS

```{r}
library(nnet)
mod0 <- multinom(regimen ~ 1, data = demofree)
summary(mod0)
```

### AIC
```{r}
AIC(mod0)
AIC(mod1) #GANADOR
AIC(mod2)
```

¬øPredice bien mi modelo?

```{r}
table(demofree$regimen,predict(mod1))
table(predict(mod1))
```


Lo vemos en %
```{r}
prop.table(table(demofree$regimen,predict(mod1)),1)
```

### PSEUDO R CUADRADO

```{r}
library("DescTools")
PseudoR2(mod1, which = c("Nagelkerke"))
PseudoR2(mod2, which = c("Nagelkerke"))
```